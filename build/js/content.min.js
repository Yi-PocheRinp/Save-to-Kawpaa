$(function(){var ChromeSyncStorageManager,HTMLMetaDataScraper,KawpaaDataPoster,ResultAlerter;return ChromeSyncStorageManager=function(){function ChromeSyncStorageManager(){}return ChromeSyncStorageManager.get=function(key){return new Promise(function(resolve,reject){return chrome.storage.sync.get([key],function(item){return void 0===item[key]||""===item[key]?reject(void 0):resolve(item[key])})})},ChromeSyncStorageManager}(),HTMLMetaDataScraper=function(){function HTMLMetaDataScraper(data1){this.data=data1}return HTMLMetaDataScraper.prototype.getTitle=function(){var t1,t2;return t1=$("head title").text(),t2=$('meta[property="og:title"]').attr("content"),t1||t2},HTMLMetaDataScraper.prototype.getSiteName=function(){var sn;return sn=$('meta[property="og:site_name"').text()},HTMLMetaDataScraper.prototype.getSiteURL=function(){var su1,su2;return su1=$(location).attr("href"),su2=$('meta[property="og:url"]').attr("content"),su1||su2},HTMLMetaDataScraper.prototype.getSiteImage=function(){var si;return si=$('meta[property="og:image"]').attr("content")},HTMLMetaDataScraper.prototype.getHostName=function(){var hn;return hn=location.host},HTMLMetaDataScraper.prototype.getType=function(){var isImage,ref,ref1,ref2,t;return isImage="image"===(null!=(ref=this.data)?ref.type:void 0)||null!=(null!=(ref1=this.data)?ref1.mediaType:void 0)&&"image"===(null!=(ref2=this.data)?ref2.menuItemId:void 0),t=isImage?"image":"link"},HTMLMetaDataScraper.prototype.getURL=function(){var $img,DEFUALT_URL,firstImgUrlInBody,ref,ref1,siteURL,u;return"image"===this.getType()?this.data.srcUrl:(siteURL=this.getSiteURL(),$img=$("img"),DEFUALT_URL="https://36.media.tumblr.com/9086462174c34becaf8b3e59de8f5800/tumblr_nzek2kWNNJ1ukgdjoo2_1280.jpg",null!=$img&&$img.length>0?(firstImgUrlInBody=$img.get(0).src,u=firstImgUrlInBody||DEFUALT_URL):u=DEFUALT_URL,(null!=(ref=this.data)&&null!=(ref1=ref.url)?ref1.indexOf("chrome-extension://"):void 0)>-1&&(u=$img.get(1).src),siteURL.indexOf("www.nicovideo.jp/watch/sm")>-1&&(u=$(".videoThumbnailImage").attr("src")),siteURL.indexOf("xvideos.com/video")>-1&&(u=$("img.thumb").attr("src")),u)},HTMLMetaDataScraper.prototype.getSiteDescription=function(){var d1,d2;return d1=$('meta[name="description"]').attr("content"),d2=$('meta[property="og:description"]').attr("content"),d1||d2},HTMLMetaDataScraper.prototype.getFavicon=function(){var f;return f=$('link[rel="shortcut icon"]').prop("href")},HTMLMetaDataScraper.prototype.get=function(){return{title:this.getTitle(),siteName:this.getSiteName(),siteUrl:this.getSiteURL(),type:this.getType(),url:this.getURL(),hostName:this.getHostName(),description:this.getSiteDescription(),siteImage:this.getSiteImage(),favicon:this.getFavicon()}},HTMLMetaDataScraper}(),KawpaaDataPoster=function(){function KawpaaDataPoster(data1){var htmlMetaData,htmlMetaDataScraper;this.data=null!=data1?data1:{},htmlMetaDataScraper=new HTMLMetaDataScraper(info),htmlMetaData=htmlMetaDataScraper.get(),this.data.isPrivate=!0,this.data.isArchive=!1,this.data=$.extend(!0,htmlMetaData,this.data)}return KawpaaDataPoster.prototype.DEST_URL="https://kawpaa.eiurur.xyz/api/posts",KawpaaDataPoster.prototype.setToken=function(){return new Promise(function(_this){return function(resolve,reject){return ChromeSyncStorageManager.get("token").then(function(token){return _this.token=token,resolve(_this)})["catch"](function(err){return reject(err)})}}(this))},KawpaaDataPoster.prototype.save2Server=function(){return new Promise(function(_this){return function(resolve,reject){return $.ajax({type:"POST",url:_this.DEST_URL,data:{token:_this.token,post:_this.data},headers:{"Access-Control-Allow-Origin":"*"}}).done(function(data){return resolve(data)}).fail(function(err){return reject(err)})}}(this))},KawpaaDataPoster}(),ResultAlerter=function(){function ResultAlerter(){}return ResultAlerter.displatySuccessResult=function(){return chrome.runtime.sendMessage({newIconPath:"build/images/blue/icon19.png"}),alertify.success("保存しました。")},ResultAlerter.displatyFailedResult=function(err){return null!=err.responseJSON?(err.statusCode=err.responseJSON.statusCode,err.statusMessage=err.responseJSON.message):null!=err.status&&(err.statusCode=err.status,err.statusMessage=err.statusText),alertify.error(err.statusCode?"Error: "+err.statusCode+" "+err.statusMessage:"Error: トークンに誤りがあります。\nもう一度確認してみてください。")},ResultAlerter}(),function(){var kawpaaDataPoster;return alertify.log("保存中 ......"),kawpaaDataPoster=new KawpaaDataPoster(info),kawpaaDataPoster.setToken().then(function(_){return kawpaaDataPoster.save2Server()}).then(function(data){return ResultAlerter.displatySuccessResult()})["catch"](function(err){return ResultAlerter.displatyFailedResult(err)})}()});