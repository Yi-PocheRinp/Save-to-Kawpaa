$(function(){var displatyFailedResult,displatySuccessResult,getToken,save2Server,scrapingMetaData;return save2Server=function(data,token){return new Promise(function(resolve,reject){var destUrl;return destUrl="https://tk2-207-13331.vs.sakura.ne.jp:9021/api/posts",$.ajax({type:"POST",url:destUrl,data:{token:token,post:data},headers:{"Access-Control-Allow-Origin":"*"}}).done(function(data){return"ok"!==data&&200!==data.statusCode?reject(data):resolve(data)}).fail(function(err){return reject(err)})})},getToken=function(){return new Promise(function(resolve,reject){return chrome.storage.sync.get(["token"],function(item){return void 0===item.token||""===item.token?reject(void 0):resolve(item.token)})})},scrapingMetaData=function(){return new Promise(function(resolve,reject){var data,description1,description2,favicon,firstImgUrlInBody,hostName,siteImage,siteName,siteUrl1,siteUrl2,title1,title2;return data={},title1=$("head title").text(),title2=$('meta[property="og:title"]').attr("content"),data.title=title1||title2,siteName=$('meta[property="og:site_name"').text(),data.siteName=siteName,siteUrl1=$(location).attr("href"),siteUrl2=$('meta[property="og:url"]').attr("content"),data.siteUrl=siteUrl1||siteUrl2,null!=("undefined"!=typeof info&&null!==info?info.mediaType:void 0)&&"image"===info.menuItemId?(data.url=info.srcUrl,data.type="image"):(firstImgUrlInBody=$("img").get(0).src,data.url=firstImgUrlInBody,data.type="link"),hostName=location.host,data.hostName=hostName,description1=$('meta[name="description"]').attr("content"),description2=$('meta[property="og:description"]').attr("content"),data.description=description1||description2,siteImage=$('meta[property="og:image"]').attr("content"),data.siteImage=siteImage,favicon=$('link[rel="shortcut icon"]').prop("href"),data.favicon=favicon,data.isPrivate=!0,data.isArchive=!1,resolve(data)})},displatySuccessResult=function(){return chrome.runtime.sendMessage({newIconPath:"build/images/blue/icon19.png"}),alertify.success("保存しました。")},displatyFailedResult=function(err){return null!=err.status&&(err.statusCode=err.status,err.statusMessage=err.statusText),alertify.error(err.statusCode?"Error: "+err.statusCode+" "+err.statusMessage:"Error: トークンに誤りがあります。\nもう一度確認してみてください。")},function(){return alertify.log("保存中 ......"),Promise.all([scrapingMetaData(),getToken()]).then(function(arg){var data,token;return data=arg[0],token=arg[1],save2Server(data,token)}).then(function(data){return displatySuccessResult()})["catch"](function(err){return displatyFailedResult(err)})}()});