$(function(){var clickHandler,contexts,executeKawpaaScript,get;return get=function(key){return new Promise(function(resolve,reject){return chrome.storage.sync.get(key,function(item){return resolve(item[key])})})},executeKawpaaScript=function(infoStr){return Promise.all([get("token"),get("pixiv_username"),get("pixiv_password")]).then(function(itemList){var info,infoStrAddedPixivData,token;return token=itemList[0],void 0!==token&&""!==token?(info=JSON.parse(infoStr),info.pixiv_username=itemList[1],info.pixiv_password=itemList[2],infoStrAddedPixivData=JSON.stringify(info),chrome.tabs.executeScript(null,{file:"build/js/vendors/lib.min.js"},function(){return chrome.tabs.insertCSS(null,{file:"build/css/vendors/lib.min.css"},function(){return chrome.tabs.executeScript(null,{code:"var info = "+infoStrAddedPixivData+";"},function(){return chrome.tabs.executeScript(null,{file:"build/js/content.js"},function(){})})})})):void 0})},chrome.browserAction.onClicked.addListener(function(tab){return executeKawpaaScript(null)}),clickHandler=function(info,tab){var KAWPAA_URL,infoStr;return"browser_action_open_kawpaa"===info.menuItemId?(KAWPAA_URL="https://kawpaa.eiurur.xyz/",void chrome.tabs.create({url:KAWPAA_URL,active:!0},function(tab){return void 0})):(infoStr=JSON.stringify(info),executeKawpaaScript(infoStr))},contexts=["page","image"],contexts.forEach(function(context){var title;return title="Save to Kawpaa with "+context,chrome.contextMenus.create({title:title,contexts:[context],id:context})}),chrome.contextMenus.create({title:"Open Kawpaa",contexts:["browser_action"],id:"browser_action_open_kawpaa"}),chrome.contextMenus.onClicked.addListener(clickHandler),chrome.runtime.onMessage.addListener(function(request,sender,sendResponse){var infoStr;return"twitter"===request.name?(infoStr=JSON.stringify(request.info),executeKawpaaScript(infoStr),void sendResponse("ok "+infoStr)):chrome.browserAction.setIcon({path:request.newIconPath,tabId:sender.tab.id})}),chrome.commands.onCommand.addListener(function(command){return executeKawpaaScript(null)})});